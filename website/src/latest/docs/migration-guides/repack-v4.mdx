import { PackageManagerTabs } from "@theme";

# Migrating from Re.Pack 4

:::info title="Re.Pack 5 now supports Rspack!"
Re.Pack 5 introduces support for [Rspack](https://rspack.dev/),
a high-performance webpack alternative with a highly compatible API.
This migration guide focuses solely on migrating from **V4** to **V5** while continuing to use webpack.

If you're interested in using Rspack (which is encouraged), we recommend first completing the migration
to **V5** with webpack and then following our separate webpack to Rspack migration guide.
:::

## Update dependencies in `package.json`

The first step is to update the Re.Pack in the `devDependencies` section of your `package.json`:

```diff
{
  "devDependencies": {
-    "@callstack/repack": "4.x.x"
+    "@callstack/repack": "~5.0.0"
  }
}
```

You can also remove `babel-loader` from your `devDependencies` as Re.Pack 5 now includes it by default:

```diff
{
  "devDependencies": {
-    "babel-loader": "^9.1.3"
  }
}
```

:::tip title="Good time to update webpack and terser-webpack-plugin"

While not necessary, for the best experience with Re.Pack 5,
we recommend updating your `webpack` and `terser-webpack-plugin` dependencies to their latest versions:

```json
{
  "devDependencies": {
    "webpack": "^5.98.0",
    "terser-webpack-plugin": "^5.3.11"
  }
}
```

:::

After updating the project dependencies, run the install command of your package manager:

<PackageManagerTabs command="install" />

## Update `react-native.config.js`

Since Re.Pack 5 now supports multiple bundlers (webpack and Rspack),
you need to specify that you want to use webpack commands explicitly.
Update your `react-native.config.js` in a following way:

```diff
module.exports = {
-  commands: require('@callstack/repack/commands'),
+  commands: require('@callstack/repack/commands/webpack'),
};
```

## Update webpack configuration

:::info title="Re.Pack 5 makes webpack configuration much smaller"
In **V5** we've significantly simplified webpack configuration templates.
Many defaults are now configured out of the box, reducing the need for explicit
configuration and making your configuration files much cleaner and easier to maintain.

For a comprehensive guide on configuring webpack using Re.Pack 5, including all available
options, defaults, and configuration variants, please refer to our
[Configuration guide](/docs/guides/configuration).
:::

### Breaking: `devtool` option is now used to configure sourcemaps

We've changed how sourcemaps are configured to align better with webpack's native configuration. The `devtool` option is now used to control the behavior of generated sourcemaps, replacing the previous `RepackPlugin` configuration. Please make sure to remove any `devtool: false` from your configuration to keep sourcemaps enabled.

```diff
-  devtool: false,
-  plugins: [
-    new RepackPlugin({
-      sourceMaps: true,
-    }),
-  ],
+  // Use webpack's native devtool option to configure sourcemaps
+  devtool: 'source-map',
```

:::tip title="You can remove the devtool option altogether"
`devtool: 'source-map'` is now the default value in **V5**.
:::

The sourcemap handling is now managed by a dedicated internal `SourceMapPlugin` that's included in the `RepackPlugin` by default - you don't need to add it separately.

### Breaking: `getInitializationEntries` was removed

The `getInitializationEntries` helper function was removed as initialization entries are now configured automatically. 

You can now simplify your entry configuration:

```diff
-  entry: [
-    ...Repack.getInitializationEntries(reactNativePath, {
-      hmr: devServer && devServer.hmr,
-    }),
-    entry,
-  ],
+  entry: './index.js', // or just entry if you're using env.entry
```

